---
title: "STAT 108: Lab 7"
author: "Tim Lanthier"
date: "3/2/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Lab 7: Logistic Regression
```{r message = FALSE}
library(tidyverse)
library(broom)
library(pROC)
library(plotROC)
library(knitr)
```

In this lab we will be investigating Spotify song attribute data from 2017 from a single user. The raw dataset can be found on the Github Repository.

```{r}
spotify <- read.csv('data/spotify.csv')
glimpse(spotify)
```


## Data Prep & Modeling

We will be creating a model to predict whether or not the user likes a song or not. Here, the response variable is `target` where 1 means the user liked the song, 0 means they did not like the song. Note that in the glimpse above, `target` is an integer value which we need to change to a factor. We also will need to change `key` to a factor.

```{r}
spotify <- spotify %>%
  mutate(target = as.factor(target), 
         key = ifelse(key == 2, 'D', ifelse(key == 3, 'D#', 'Other')))
```

```{r}
ggplot(data = spotify, aes(x = target)) +
  geom_bar() +
  labs(x = 'Target', title = 'Distribution of Target')

ggplot(data = spotify, aes(x = key)) +
  geom_bar() +
  labs(x = 'Key', title = 'Distribution of Key')

ggplot(data = spotify, aes(x = key, fill = target)) +
  geom_bar(position = 'fill') +
  labs(x = 'Key', y = 'Proportion', title = 'Key vs Target')
```
According to the above plot, it looks like the user appears to dislike songs in D# shown by a approximately 30\% of the songs in D# being liked by the user. Meanwhile the user likes approximately 60\% of the songs in D and around 50% of the songs in other keys. Now we will build a logistic regression model to predict `target` using `acousticness`, `danceability`, `duration_ms`, `instrumentalness`, `loudness`, `speechiness`, and `valence` as our predictors.

```{r}
model <- glm(target ~ acousticness + danceability + duration_ms + instrumentalness + loudness + speechiness + valence,  
             data = spotify, 
             family = 'binomial')
tidy(model, conf.int=TRUE) %>%
  kable(digits = 3)
```




